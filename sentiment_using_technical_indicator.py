import yfinance as yf
import pandas as pd

# Download historical data using 'period' instead of 'start' and 'end'
ticker = "AAPL"
data = yf.download(ticker, period="1y")

# Calculate Moving Average
data['MA50'] = data['Close'].rolling(window=50).mean()
data['MA200'] = data['Close'].rolling(window=200).mean()

# Calculate MACD
exp12 = data['Close'].ewm(span=12, adjust=False).mean()
exp26 = data['Close'].ewm(span=26, adjust=False).mean()
data['MACD'] = exp12 - exp26
data['Signal Line'] = data['MACD'].ewm(span=9, adjust=False).mean()

# Calculate RSI
delta = data['Close'].diff(1)
gain = (delta.where(delta > 0, 0)).rolling(window=14).mean()
loss = (-delta.where(delta < 0, 0)).rolling(window=14).mean()
rs = gain / loss
data['RSI'] = 100 - (100 / (1 + rs))

# Drop NA values generated by moving averages and RSI
data = data.dropna()

# Prediction Logic
data['Prediction'] = "Neutral"
data.loc[(data['MA50'] > data['MA200']) & (data['MACD'] > data['Signal Line']) & (data['RSI'] > 50), 'Prediction'] = 'Buy'
data.loc[(data['MA50'] < data['MA200']) | (data['MACD'] < data['Signal Line']) | (data['RSI'] < 50), 'Prediction'] = 'Sell'

# Print Recent Prediction
recent_prediction = data['Prediction'].iloc[-1]
print(f"Recent prediction based on Moving Average, MACD & RSI for the last 1 year: {recent_prediction}")
